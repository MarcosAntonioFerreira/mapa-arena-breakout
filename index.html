<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Mapa Interativo</title>

<style>
body {
  margin: 0;
  background: #111;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

#mapa {
  position: relative;
  width: 90vw;
  height: 80vh;
  background: url("./mapa-arena.png") center/contain no-repeat;
  cursor: crosshair;
}

.ponto {
  position: absolute;
  width: 14px;
  height: 14px;
  background: red;
  border-radius: 50%;
  transform: translate(-50%, -50%);
}

#toolbar {
  position: fixed;
  top: 10px;
  left: 10px;
}
</style>
</head>

<body>

<div id="toolbar">
  <button onclick="limpar()">Limpar</button>
</div>

<div id="mapa"></div>

<script>
const API = "https://script.google.com/macros/s/AKfycby9lq7f4DXcStMa0GJXgnJOmCcofR3nihaTo4rUG3eNBFOsJ_jweVEzZNfLnOoJUXY-/exec";
const mapa = document.getElementById("mapa");

// ðŸ”¹ carregar pontos
async function carregar() {
  const res = await fetch(`${API}?acao=listar`);
  const pontos = await res.json();

  pontos.forEach(p => criarPonto(p.x, p.y, false));
}

// ðŸ”¹ criar ponto
function criarPonto(x, y, salvar = true) {
  const p = document.createElement("div");
  p.className = "ponto";
  p.style.left = x + "px";
  p.style.top = y + "px";

  p.oncontextmenu = e => {
    e.preventDefault();
    p.remove();
    fetch(`${API}?acao=desativar&x=${x}&y=${y}`);
  };

  mapa.appendChild(p);

  if (salvar) {
    fetch(`${API}?acao=ativar&x=${x}&y=${y}`);
  }
}

// ðŸ”¹ clique para adicionar
mapa.onclick = e => {
  const rect = mapa.getBoundingClientRect();
  const x = Math.round(e.clientX - rect.left);
  const y = Math.round(e.clientY - rect.top);
  criarPonto(x, y);
};

// ðŸ”¹ limpar tudo
function limpar() {
  document.querySelectorAll(".ponto").forEach(p => p.remove());
  fetch(`${API}?acao=limpar`);
}

carregar();
</script>

</body>
</html>

