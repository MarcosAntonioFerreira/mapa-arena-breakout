<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Mapa Interativo</title>

<style>
body {
  margin: 0;
  background: #111;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

#mapa {
  position: relative;
  width: 90vw;
  height: 80vh;
  background: url("./mapa-arena.png") center/contain no-repeat;
  cursor: crosshair;
}

.ponto {
  position: absolute;
  width: 14px;
  height: 14px;
  background: red;
  border-radius: 50%;
  transform: translate(-50%, -50%);
}

#toolbar {
  position: fixed;
  top: 10px;
  left: 10px;
}
</style>
</head>

<body>

<div id="toolbar">
  <button onclick="limpar()">Limpar</button>
</div>

<div id="mapa"></div>
<script>
/* =============================
   CONFIG
============================= */
const API = 'https://script.google.com/macros/s/AKfycby9lq7f4DXcStMa0GJXgnJOmCcofR3nihaTo4rUG3eNBFOsJ_jweVEzZNfLnOoJUXY-/exec';

/* =============================
   ELEMENTOS
============================= */
const mapa = document.getElementById('mapa');
const container = mapa; // O PRÓPRIO MAPA É O CONTAINER

/* =============================
   LOAD
============================= */
window.onload = carregarPontos;

/* =============================
   CARREGAR PONTOS
============================= */
async function carregarPontos() {
  removerTodosPontos();

  try {
    const res = await fetch(API + '?acao=listar');
    const dados = await res.json();

    dados.forEach(p => {
      if (p.status === 'ativo') {
        desenharPonto(p.id, p.x, p.y);
      }
    });

  } catch (err) {
    console.error('Erro ao carregar pontos', err);
  }
}

/* =============================
   DESENHAR
============================= */
function desenharPonto(id, x, y) {
  const ponto = document.createElement('div');
  ponto.className = 'ponto';
  ponto.dataset.id = id;
  ponto.style.left = x + 'px';
  ponto.style.top = y + 'px';

  ponto.onclick = async (e) => {
    e.stopPropagation();
    await fetch(`${API}?acao=desativar&id=${id}`);
    ponto.remove();
  };

  container.appendChild(ponto);
}

/* =============================
   CLICK MAPA → INSERIR
============================= */
mapa.addEventListener('click', async function (e) {
  const rect = mapa.getBoundingClientRect();
  const x = Math.round(e.clientX - rect.left);
  const y = Math.round(e.clientY - rect.top);
  const id = `ponto-${Date.now()}`;

  try {
    await fetch(`${API}?acao=ativar&id=${id}&x=${x}&y=${y}`);
    desenharPonto(id, x, y);
  } catch (err) {
    console.error('Erro ao criar ponto', err);
  }
});

/* =============================
   LIMPAR
============================= */
async function limpar() {
  await fetch(API + '?acao=limpar');
  removerTodosPontos();
}

/* =============================
   UTILS
============================= */
function removerTodosPontos() {
  container.querySelectorAll('.ponto').forEach(p => p.remove());
}
</script>

</body>
</html>

